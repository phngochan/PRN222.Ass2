@{
    var page = ViewContext.RouteData.Values["page"]?.ToString() ?? "/";
    string[] segments = page.Trim('/').Split('/', StringSplitOptions.RemoveEmptyEntries);

    var nameMap = new Dictionary<string, string>(StringComparer.OrdinalIgnoreCase)
    {
        { "Dashboard", "Dashboard" },
        { "Admin", "Admin" },
        { "Manager", "Quản lý" },
        { "Staff", "Nhân viên" },
        { "VehiclesManagement", "Quản lý Xe điện" },
        { "UsersManagement", "Quản lý Người dùng" },
        { "DealersManagement", "Quản lý Đại lý" },
        { "CustomerManagement", "Quản lý Khách hàng" },
        { "Orders", "Đơn hàng" },
        { "TestDrive", "Lịch lái thử" },
        { "Create", "Tạo mới" },
        { "Edit", "Chỉnh sửa" },
        { "Details", "Chi tiết" },
        { "Delete", "Xóa" },
    };

    string ToReadable(string input)
    {
        if (string.IsNullOrWhiteSpace(input)) return "";
        return nameMap.TryGetValue(input, out var readable)
            ? readable
            : char.ToUpper(input[0]) + input.Substring(1);
    }

    // Nếu trang hiện tại là Index, bỏ qua segment cuối
    if (segments.Length > 0 && segments.Last().Equals("Index", StringComparison.OrdinalIgnoreCase))
    {
        segments = segments.Take(segments.Length - 1).ToArray();
    }
}

<nav aria-label="breadcrumb" class="ev-breadcrumb">
    <ol class="breadcrumb">
        @* Trang chủ hoặc Dashboard *@
        @if ((User.Identity?.IsAuthenticated ?? false) && User.IsInRole("4"))
        {
            <li class="breadcrumb-item">
                <a asp-page="/">
                    <i class="fas fa-home"></i> Trang Chủ
                </a>
            </li>
        }
        else
        {
            <li class="breadcrumb-item">
                <a asp-page="/Dashboard/Index">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
            </li>
        }

        @if (segments.Length > 0 && page != "/" && page != "/Dashboard/Index")
        {
            for (int i = 0; i < segments.Length; i++)
            {
                if (segments[i].Equals("Dashboard", StringComparison.OrdinalIgnoreCase))
                    continue;

                string path = "/" + string.Join("/", segments.Take(i + 1));
                bool isLast = i == segments.Length - 1;
                string label = ToReadable(segments[i]);

                if (!isLast)
                {
                    path += "/Index";
                }

                if (isLast)
                {
                    <li class="breadcrumb-item active" aria-current="page">@label</li>
                }
                else
                {
                    <li class="breadcrumb-item">
                        <a asp-page="@path">@label</a>
                    </li>
                }
            }
        }
    </ol>
</nav>

<style>
    .ev-breadcrumb {
        background-color: transparent;
        padding: 1rem 0;
        margin-bottom: 1.5rem;
    }

        .ev-breadcrumb .breadcrumb {
            background-color: var(--ev-pale-green);
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            margin-bottom: 0;
        }

        .ev-breadcrumb .breadcrumb-item a {
            color: var(--ev-dark-green);
            text-decoration: none;
            transition: all 0.3s;
        }

            .ev-breadcrumb .breadcrumb-item a:hover {
                color: var(--ev-medium-green);
                padding-left: 5px;
            }

        .ev-breadcrumb .breadcrumb-item.active {
            color: var(--ev-text-dark);
            font-weight: 600;
        }

        .ev-breadcrumb .breadcrumb-item + .breadcrumb-item::before {
            content: "›";
            color: var(--ev-medium-green);
            font-weight: bold;
        }
</style>
